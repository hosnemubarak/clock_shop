{% extends 'base.html' %}
{% load i18n %}

{% block title %}Audit Logs | {{ SHOP_NAME }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">{% trans "Audit Logs" %}</h4>
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">{% trans "Dashboard" %}</a></li>
                    <li class="breadcrumb-item active">{% trans "Audit Logs" %}</li>
                </ol>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <form method="get" class="row g-3">
                    <div class="col-md-3">
                        <input type="text" name="search" class="form-control" placeholder="{% trans 'Search logs...' %}" value="{{ search }}">
                    </div>
                    <div class="col-md-2">
                        <select name="action" class="form-select">
                            <option value="">{% trans "All Actions" %}</option>
                            <option value="CREATE" {% if selected_action == 'CREATE' %}selected{% endif %}>{% trans "Create" %}</option>
                            <option value="UPDATE" {% if selected_action == 'UPDATE' %}selected{% endif %}>{% trans "Update" %}</option>
                            <option value="DELETE" {% if selected_action == 'DELETE' %}selected{% endif %}>{% trans "Delete" %}</option>
                            <option value="SALE" {% if selected_action == 'SALE' %}selected{% endif %}>{% trans "Sale" %}</option>
                            <option value="PAYMENT" {% if selected_action == 'PAYMENT' %}selected{% endif %}>{% trans "Payment" %}</option>
                            <option value="STOCK_IN" {% if selected_action == 'STOCK_IN' %}selected{% endif %}>{% trans "Stock In" %}</option>
                            <option value="STOCK_OUT" {% if selected_action == 'STOCK_OUT' %}selected{% endif %}>{% trans "Stock Out" %}</option>
                            <option value="TRANSFER" {% if selected_action == 'TRANSFER' %}selected{% endif %}>{% trans "Transfer" %}</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select name="user" class="form-select">
                            <option value="">{% trans "All Users" %}</option>
                            {% for user in users %}
                            <option value="{{ user.id }}" {% if selected_user == user.id|stringformat:"s" %}selected{% endif %}>{{ user.username }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-primary w-100">{% trans "Filter" %}</button>
                    </div>
                    <div class="col-md-2">
                        <a href="{% url 'audit_logs' %}" class="btn btn-outline-secondary w-100">{% trans "Clear" %}</a>
                    </div>
                </form>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-nowrap align-middle mb-0">
                        <thead>
                            <tr>
                                <th>{% trans "Timestamp" %}</th>
                                <th>{% trans "User" %}</th>
                                <th>{% trans "Action" %}</th>
                                <th>{% trans "Model" %}</th>
                                <th>{% trans "Description" %}</th>
                                <th>{% trans "IP Address" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in logs %}
                            <tr>
                                <td>{{ log.timestamp|date:"M d, Y H:i" }}</td>
                                <td>{{ log.user.username|default:"-" }}</td>
                                <td>
                                    <span class="badge 
                                        {% if log.action == 'CREATE' %}bg-success
                                        {% elif log.action == 'UPDATE' %}bg-info
                                        {% elif log.action == 'DELETE' %}bg-danger
                                        {% elif log.action == 'SALE' %}bg-primary
                                        {% elif log.action == 'PAYMENT' %}bg-success
                                        {% else %}bg-secondary{% endif %}">
                                        {{ log.action }}
                                    </span>
                                </td>
                                <td>{{ log.model_name }}</td>
                                <td>{{ log.object_repr|truncatechars:50 }}</td>
                                <td><small>{{ log.ip_address|default:"-" }}</small></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="text-center text-muted">{% trans "No audit logs found" %}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% with page_obj=logs %}
                {% include 'includes/pagination.html' %}
                {% endwith %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
